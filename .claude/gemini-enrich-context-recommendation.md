# Recommendation: Enriching Distill Context for AI Agents

**Source**: Generated by Gemini (Antigravity) on 2026-01-05.
**Context**: Result of a "dogfooding" session where the agent acted as a code reviewer consuming the `distill diff:annotate --json` output.
**Prompt**: The user asked for an "Ultrathought" opinion on how to improve the tool's utility for AI-driven code review, specifically excluding line number improvements (which were deemed difficult/roadmap items). The goal was to identify what _else_ would make `distill` a superior reviewing tool in the absence of precise location data.

---

To make `distill` a superior tool for AI-driven code review—even without precise line numbers—we should focus on **enriching the context** and **reducing the cognitive load** (parsing work) for the agent.

Currently, `distill` outputs a "diff highlight". We want to transform it into a "static analysis data feed". Here are three specific enhancements:

### 1. Structured "Captures" (The Data Layer)

Instead of just outputting the text matched by a filter, expose the specific _captures_ from `tsq` (Tree-sitter) or `regex`.

- **Why**: If a rule matches a deprecated function call, valid `tsq` can extract the specific function name.
- **Agent Benefit**: Instead of parsing the `diffText` to find "which function changed?", I receive `{"function_name": "componentWillMount", "replacement": "componentDidMount"}`. This allows me to execute precise logic (e.g., checking migration guides) instantly without token-heavy text processing.

### 2. Semantic Rule Identity (The Intent Layer)

Include metadata about the _check_ itself in the JSON output, such as `ruleId`, `checkName`, or `tags` (e.g., `["security", "breaking-change", "style"]`).

- **Why**: The `message` tells me _what_ happened, but `tags` tell me _how much I should care_.
- **Agent Benefit**: I can route reviews based on my persona. A "Security Bot" agent can simply filter for `tags.includes("security")` and ignore style changes, making processing cheaper and more focused.

### 3. Symbolic Context (The Scope Layer)

Even without line numbers, knowing the **symbolic location** of a change is incredibly powerful.

- **Why**: A change to `package.json` is global, but a change to `src/utils.ts` is local.
- **Improvement**: Update filters to report the "closest parent definition" (e.g., extracting the enclosing class or function name via `ast-grep` or `tsq`).
- **Agent Benefit**: I can generate comments like _"In method `User.validate()`, this change introduces..."_ which are significantly more helpful to humans than a floating comment, and helps me reference the change's scope.

**Summary**: By shifting from "formatted text reports" to "structured capture data," `distill` becomes a native data source for agents, allowing us to reason about _code semantics_ rather than just _text diffs_.
